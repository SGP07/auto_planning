<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planning</title>
<style>
  /* Default styles for the result container */
  #resultContainer {
    margin-top: 20px;
    padding: 10px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    overflow-wrap: break-word;
  }
</style>
</head>
<body>
<h1>Upload File</h1>
<form id="uploadForm" enctype="multipart/form-data">
  <label for="file">Select File:</label>
  <input type="file" id="file" name="file"><br><br>
  <label for="group1">Group TP:</label>
  <input type="text" id="group1" name="group1" placeholder="TPD"><br><br>
  <label for="group2">Group TD:</label>
  <input type="text" id="group2" name="group2" placeholder="TDC"><br><br>
  <label for="flip">Select Flip:</label>
  <select id="flip" name="flip">
    <option value="false">Normal</option>
    <option value="true">Flipped</option>
  </select><br><br>
  <button type="submit">Submit</button>
</form>

<div id="resultContainer"></div>

<script>
  document.getElementById('uploadForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    
    const fileInput = document.getElementById('file');
    const file = fileInput.files[0];
    const group1 = document.getElementById('group1').value.toUpperCase();
    const group2 = document.getElementById('group2').value.toUpperCase();
    const flip = document.getElementById('flip').value === 'true';

    const formData = new FormData();
    formData.append('file', file, file.name);

    try {
      const url = `http://127.0.0.1:8000/uploadfile/?tp=${group1}&td=${group2}&selected_week=0&flip=${flip}`;
      const response = await fetch(url, {
        method: 'POST',
        body: formData
      });
      const data = await response.json();

    // Display the HTML result
    const resultContainer = document.getElementById('resultContainer');
    resultContainer.innerHTML = data.html;
    console.log(data.html)

    // Add CSS to <style> tag in <head>
    const styleTag = document.createElement('style');
    styleTag.innerHTML = data.css;
    document.head.appendChild(styleTag);
    } catch (error) {
    alert('An error occurred');
    console.error(error);
    }
    });
</script>
</body>
</html>
